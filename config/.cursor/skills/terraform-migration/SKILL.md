---
name: terraform-migration
description: TerraformでのDBスキーマ変更を伴う際の安全なマイグレーション手順を管理します。DB変更を含むインフラ更新時に使用します。
---

# Terraform Migration Skill

DBスキーマ変更を伴うインフラ変更において、サービスの停止やデータの損失を防ぐための手順を定義します。

## 指針

**「DBスキーマ変更を伴う terraform apply を直接行わない」**

DBの変更が必要な場合は、以下のステップを踏んでください：

1.  **マイグレーションファイルの作成**: アプリケーションレイヤー（または専用のツール）でマイグレーションスクリプトを作成・実行する。
2.  **スキーマ変更の反映**: DBのスキーマが変更された後で、Terraformの状態を最新のスキーマに合わせる（importやrefreshを活用）。
3.  **インフラの適用**: 最終的な構成の整合性を取るために `terraform apply` を実行する。

## 注意事項
- カラムの削除やリネームは、アプリケーション側での参照がなくなっていることを確認してから行う「2段階リリース」を徹底してください。
